'use client';
import{__rest as e}from"tslib";import r,{useState as t,useMemo as o}from"react";import{border as a}from"../../../lib/shape.js";import{sizing as d}from"../../../lib/sizing.js";import{spacing as l}from"../../../lib/spacing.js";import{tremorTwMerge as n}from"../../../lib/tremorTwMerge.js";import{startOfToday as m,startOfMonth as s}from"date-fns";import{enUS as i}from"date-fns/locale";import u from"../../../hooks/useInternalState.js";import{defaultOptions as c,parseStartDate as f,parseEndDate as b,formatSelectedDates as p,makeDateRangePickerClassName as k}from"./dateRangePickerUtils.js";import"../Select/Select.js";import g from"../Select/SelectItem.js";import v from"../../../assets/XCircleIcon.js";import{Popover as w,Listbox as h}from"@headlessui/react";import{getNodeText as x,constructValueToNameMapping as E,getSelectButtonColors as N,hasValue as j}from"../selectUtils.js";import y from"../Calendar/Calendar.js";const X=m(),C=r.forwardRef(((m,C)=>{var S,D;const{value:R,defaultValue:V,onValueChange:B,enableSelect:_=!0,minDate:P,maxDate:I,placeholder:M="Select",selectPlaceholder:z="Select",disabled:F=!1,locale:O=i,enableClear:T=!0,children:L,className:U}=m,Y=e(m,["value","defaultValue","onValueChange","enableSelect","minDate","maxDate","placeholder","selectPlaceholder","disabled","locale","enableClear","children","className"]),[q,A]=u(V,R),[G,H]=t(!1),[J,K]=t(!1),Q=o((()=>{const e=[];return P&&e.push({before:P}),I&&e.push({after:I}),e}),[P,I]),W=o((()=>{const e=new Map;return L?r.Children.forEach(L,(r=>{var t;e.set(r.props.value,{text:null!==(t=x(r))&&void 0!==t?t:r.props.value,from:r.props.from,to:r.props.to})})):c.forEach((r=>{e.set(r.value,{text:r.text,from:r.from,to:X})})),e}),[L]),Z=o((()=>{if(L)return E(L);const e=new Map;return c.forEach((r=>e.set(r.value,r.text))),e}),[L]),$=null==q?void 0:q.selectValue,ee=f(null==q?void 0:q.from,P,$,W),re=b(null==q?void 0:q.to,I,$,W),te=ee||re?p(ee,re,O):M,oe=s(null!==(D=null!==(S=null!=re?re:ee)&&void 0!==S?S:I)&&void 0!==D?D:X),ae=T&&!F;return r.createElement("div",Object.assign({ref:C,className:n("w-full min-w-[10rem] relative flex justify-between text-tremor-default","max-w-sm",U)},Y),r.createElement(w,{as:"div",className:n("w-full overflow-hidden",_?"rounded-l-tremor-default":"rounded-tremor-default",G&&"ring-2 ring-tremor-brand-muted dark:focus:ring-dark-tremor-brand-muted")},r.createElement("div",{className:"relative w-full overflow-hidden"},r.createElement(w.Button,{onFocus:()=>H(!0),onBlur:()=>H(!1),disabled:F,className:n("w-full outline-none text-left whitespace-nowrap truncate focus:ring-2 transition duration-100 rounded-l-tremor-default","rounded-l-tremor-default border-tremor-border shadow-tremor-input text-tremor-content-emphasis focus:border-tremor-brand-subtle","dark:border-dark-tremor-border dark:shadow-dark-tremor-input dark:text-dark-tremor-content-emphasis dark:focus:border-dark-tremor-brand-subtle",_?"rounded-l-tremor-default":"rounded-tremor-default",l.twoXl.paddingLeft,ae?l.fourXl.paddingRight:l.twoXl.paddingRight,l.sm.paddingY,a.sm.all,N(j(ee||re),F))},te),ae&&ee?r.createElement("button",{className:n("absolute outline-none inset-y-0 right-0 flex items-center transition duration-100",l.twoXl.marginRight),onClick:e=>{e.preventDefault(),null==B||B({}),A({})}},r.createElement(v,{className:n(k("clearIcon"),"flex-none","text-tremor-content-subtle","dark:text-dark-tremor-content-subtle",d.md.height,d.md.width)})):null),r.createElement(w.Panel,{className:n("absolute z-10 divide-y overflow-y-auto min-w-min left-0 outline-none rounded-tremor-default p-3","bg-tremor-background border-tremor-border divide-tremor-border shadow-tremor-dropdown","dark:bg-dark-tremor-background dark:border-dark-tremor-border dark:divide-dark-tremor-border dark:shadow-dark-tremor-dropdown",l.twoXs.marginTop,l.twoXs.marginBottom,a.sm.all)},r.createElement(y,{mode:"range",showOutsideDays:!0,defaultMonth:oe,selected:{from:ee,to:re},onSelect:e=>{null==B||B({from:null==e?void 0:e.from,to:null==e?void 0:e.to}),A({from:null==e?void 0:e.from,to:null==e?void 0:e.to})},locale:O,disabled:Q,classNames:{day_range_middle:n("!rounded-none aria-selected:!bg-tremor-background-subtle aria-selected:dark:!bg-dark-tremor-background-subtle aria-selected:!text-tremor-content aria-selected:dark:!bg-dark-tremor-background-subtle"),day_range_start:"rounded-r-none rounded-l-tremor-small aria-selected:text-tremor-brand-inverted dark:aria-selected:text-dark-tremor-brand-inverted",day_range_end:"rounded-l-none rounded-r-tremor-small aria-selected:text-tremor-brand-inverted dark:aria-selected:text-dark-tremor-brand-inverted"}}))),_&&r.createElement(h,{as:"div",className:n("w-48 overflow-hidden -ml-px rounded-r-tremor-default",J&&"ring-2 ring-tremor-brand-muted dark:focus:ring-dark-tremor-brand-muted"),value:$,onChange:e=>{const{from:r,to:t}=W.get(e),o=null!=t?t:X;null==B||B({from:r,to:o,selectValue:e}),A({from:r,to:o,selectValue:e})},disabled:F},(({value:e})=>{var t;return r.createElement(r.Fragment,null,r.createElement(h.Button,{onFocus:()=>K(!0),onBlur:()=>K(!1),className:n("w-full outline-none text-left whitespace-nowrap truncate rounded-r-tremor-default transition duration-100","border-tremor-border shadow-tremor-input text-tremor-content-emphasis focus:border-tremor-brand-subtle","dark:border-dark-tremor-border dark:shadow-dark-tremor-input dark:text-dark-tremor-content-emphasis dark:focus:border-dark-tremor-brand-subtle",l.twoXl.paddingLeft,l.twoXl.paddingRight,l.sm.paddingY,a.sm.all,N(j(e),F))},e&&null!==(t=Z.get(e))&&void 0!==t?t:z),r.createElement(h.Options,{className:n("absolute z-10 divide-y overflow-y-auto w-full inset-x-0 right-0 outline-none","shadow-tremor-dropdown bg-tremor-background border-tremor-border divide-tremor-border rounded-tremor-default","dark:shadow-dark-tremor-dropdown dark:bg-dark-tremor-background dark:border-dark-tremor-border dark:divide-dark-tremor-border",l.twoXs.marginTop,l.twoXs.marginBottom,a.sm.all)},null!=L?L:c.map((e=>r.createElement(g,{key:e.value,value:e.value},e.text)))))})))}));C.displayName="DateRangePicker";export{C as default};
